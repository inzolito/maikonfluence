<!DOCTYPE html>
<html>
    <head>
        <title>Product: MineOperate OP Pro : Debugging the ReactJS Panel</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Product: MineOperate OP Pro</a></span>
                            </li>
                                                    <li>
                                <span><a href="MineOperate-OP-Pro_224018004.html">MineOperate OP Pro</a></span>
                            </li>
                                                    <li>
                                <span><a href="Product-Releases_228590211.html">Product Releases</a></span>
                            </li>
                                                    <li>
                                <span><a href="OP-Pro-3.0_231785728.html">OP Pro 3.0</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Product: MineOperate OP Pro : Debugging the ReactJS Panel
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> GEORGE Nathan</span> on feb 16, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><div class="contentLayout2">
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1764958243564 {padding: 0px;}
div.rbtoc1764958243564 ul {margin-left: 0px;}
div.rbtoc1764958243564 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1764958243564'>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-GVOS'>GVOS</a>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-JAMSInterface'>JAMS Interface</a></li>
<li><a href='#DebuggingtheReactJSPanel-SchemaMapping'>Schema Mapping</a></li>
<li><a href='#DebuggingtheReactJSPanel-GvWeb'>GvWeb</a></li>
<li><a href='#DebuggingtheReactJSPanel-GvMQTT'>GvMQTT</a></li>
<li><a href='#DebuggingtheReactJSPanel-Replicas'>Replicas</a></li>
<li><a href='#DebuggingtheReactJSPanel-Configurations'>Configurations</a>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-ConfiguringthedeviceforGVOS/JAMSintegration'>Configuring the device for GVOS/JAMS integration</a></li>
</ul>
</li>
<li><a href='#DebuggingtheReactJSPanel-LogFiles'>Log Files</a></li>
<li><a href='#DebuggingtheReactJSPanel-RelevantGVOSLogs'>Relevant GVOS Logs</a></li>
</ul>
</li>
<li><a href='#DebuggingtheReactJSPanel-Mosquitto'>Mosquitto</a></li>
<li><a href='#DebuggingtheReactJSPanel-Nginx'>Nginx</a></li>
<li><a href='#DebuggingtheReactJSPanel-TimeSynchronization'>Time Synchronization</a>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-Chrony'>Chrony</a></li>
<li><a href='#DebuggingtheReactJSPanel-Ntpd'>Ntpd</a></li>
</ul>
</li>
<li><a href='#DebuggingtheReactJSPanel-Accessingthepanellog'>Accessing the panel log</a></li>
<li><a href='#DebuggingtheReactJSPanel-RestartingtheReactpanel'>Restarting the React panel</a></li>
<li><a href='#DebuggingtheReactJSPanel-Simulating'>Simulating</a>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-SimulatingGVOS'>Simulating GVOS</a></li>
<li><a href='#DebuggingtheReactJSPanel-SimulatingJAMS'>Simulating JAMS</a>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-SimulatingaJAMSclient'>Simulating a JAMS client</a></li>
<li><a href='#DebuggingtheReactJSPanel-SimulatingaJAMSserver'>Simulating a JAMS server</a></li>
</ul>
</li>
<li><a href='#DebuggingtheReactJSPanel-SimulatingaReactpanel'>Simulating a React panel</a>
<ul class='toc-indentation'>
<li><a href='#DebuggingtheReactJSPanel-Nginxconfiguration'>Nginx configuration</a></li>
<li><a href='#DebuggingtheReactJSPanel-Mosquittoconfiguration'>Mosquitto configuration</a></li>
<li><a href='#DebuggingtheReactJSPanel-Panelconfiguration'>Panel configuration</a></li>
<li><a href='#DebuggingtheReactJSPanel-Startingthepanel'>Starting the panel</a></li>
<li><a href='#DebuggingtheReactJSPanel-ConfiguringDevTools'>Configuring DevTools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-GVOS">GVOS</h1><h2 id="DebuggingtheReactJSPanel-JAMSInterface">JAMS Interface</h2><p>Since GVOS and Jigsaw are both using the same database, GVOS serves as the replicator client for pushing and receiving updates for both Jigsaw and GVOS. This means that the on board Jigsaw server is not running a replicator client. Instead, JAMS and GVOS communicate with each other using the JProtoSQL interface similar to how OPProManager clients communicate with the JAMS server. All of the database operations performed by JAMS are sent through the JProtoSQL interface and executed by GVOS. Because JAMS does not configure its own replicator client, you'll notice that the JAMS config file (found in /etc/config.jams) is different than the config file that you usually find on board the equipment. The JAMS configuration file should only contain one line &quot;[host &lt;equipment name&gt;]&quot;.</p><h2 id="DebuggingtheReactJSPanel-SchemaMapping">Schema Mapping</h2><p>While the schemas for the GVOS and Jigsaw databases have mostly been merged, there are some key differences in some table and column names that require translation between the two systems. You'll notice that the postgres database on the server uses the Jigsaw database schema with the gvos schema merged into it so that all of the tables and columns match the schema required by Jigsaw. However, the sqlite database onboard the equipment uses the GVOS database schema with the Jigsaw schema merged into it so that all of the tables and column names match the GVOS schema. For example, on the server the JAMS schema is used for the configurations table (notice that the column names match the names for the Jigsaw schema and that 'override', a gvos column, has been added):</p><blockquote><p>cmkc_test=&gt; \d configurations<br/>Table &quot;public.configurations&quot;<br/>Column | Type | Modifiers <br/>-------------+-----------------------------+-------------------------------------------------------------<br/>id | integer | not null default nextval('configurations_id_seq'::regclass)<br/>updated_at | timestamp without time zone | <br/>device_id | integer | <br/>module | character varying(256) | <br/>attribute | character varying(256) | <br/>value | text | <br/>application | character varying(40) | <br/>override | boolean |</p></blockquote><p>Meanwhile, the configurations table in the onboard sqlite database uses the GVOS schema (notice that module is now called component and attribute is now called property:</p><blockquote><p>sqlite&gt; .schema configurations<br/>CREATE TABLE configurations (id integer primary key,updated_at datetime,device_id int(4),component varchar(256),property varchar(256),value text,application varchar(40),override int(1));</p></blockquote><p>The mapping between database schemas is handled by GVOS on the server and onboard by parsing database queries and applying the relevant schema mapping to form the correct query. The mapping for column names is hard coded in the GvModel definition for the model while the mapping for table names is configurable through the jams_schema component table_map property. The default configuration for the table mapping is:</p><blockquote><p>table_map=workers=employees,shift_logins=logins,change_configurations=change_configs,worker_vacations=vacations,worker_qualifications=qualifications,replicas_oas=replicas</p></blockquote><p><br/></p><h2 id="DebuggingtheReactJSPanel-GvWeb">GvWeb</h2><p>The GVOS REST API is contained in the GvWeb module. By default, GvWeb listens on port 5000 for incoming HTTP requests. GvWeb can be used to query model schema, query model data, and invoke GVOS and JAMS methods remotely. Some useful queries are:</p><ul><li>http://localhost:5000<strong>/gvos/schema/&lt;Model Name&gt;</strong> this returns information about the schema of the model. For example, <a class="external-link" href="http://localhost:5000/gvos/schema/GvEquipment" rel="nofollow">http://localhost:5000/gvos/schema/GvEquipment</a> will return the schema information for the GvEquipment model.</li><li>http://localhost:5000<strong>/gvos/object/&lt;Model Name&gt; </strong>this returns all of the records for the model in JSON format so that it includes each column name. For example, <a class="external-link" href="http://localhost:5000/gvos/schema/GvEquipment" rel="nofollow">http://localhost:5000/gvos/object/GvEquipment</a> will return all of the equipment records.</li><li>http://localhost:5000<strong>/gvos/object/&lt;Model Name&gt;/&lt;id&gt; </strong>this returns a specific record for the model. For example, <a class="external-link" href="http://localhost:5000/gvos/object/GvEquipment/1" rel="nofollow">http://localhost:5000/gvos/object/GvEquipment/1</a> will return the equipment record that has an id equal to 1.</li><li>http://localhost:5000<strong>/gvos/object/&lt;Model Name&gt;/&lt;column 1&gt;,&lt;column 2&gt;,...,&lt;column n&gt; </strong>this returns the data with only the columns specified in the query. For example, <a class="external-link" href="http://localhost:5000/gvos/object/GvEquipment/id,type,name" rel="nofollow">http://localhost:5000/gvos/object/GvEquipment/id,type,name</a> will return only the id, type and name fields for each record.</li><li>http://localhost:5000<strong>/gvos/object/&lt;Model Name&gt;?&lt;condition 1&gt;and&lt;condition 2&gt; </strong>this can be used to add conditions to the query. For example, <a class="external-link" href="http://localhost:5000/gvos/object/GvEquipment?type=truck%20and%20status_id=50" rel="nofollow">http://localhost:5000/gvos/object/GvEquipment?type=truck%20and%20status_id=50</a> will return all records where the type is truck and the status id is 50.</li><li>All of these can be combined to form more complex queries such as http://localhost:5000<strong>/gvos/object/&lt;Model Name&gt;/&lt;column 1&gt;,&lt;column 2&gt;,order=&lt;column 1&gt; DESC?&lt;condition 1&gt;and&lt;condition 2&gt;</strong>, for example, <a class="external-link" href="http://localhost:5000/gvos/object/GvEquipment/id,type,name" rel="nofollow">http://localhost:5000/gvos/object/GvEquipment/id,updated_at,type,name</a>,order=updated_at%20DESC?<a class="external-link" href="http://localhost:5000/gvos/object/GvEquipment?type=truck%20and%20status_id=50" rel="nofollow">type=truck%20and%20status_id=50</a> will return the id, updated_at, type, and name columns for all records where type is equal to truck and status_id is equal to 50 using the updated_at column to order in descending order.</li><li><a class="external-link" href="http://localhost:5000" rel="nofollow">http://localhost:5000</a><strong>/gvos/&lt;Module&gt;/&lt;Method&gt;</strong> returns the result of executing the method for the module. For example, <a class="external-link" href="http://localhost:5000/gvos/GvDevice/this_device" rel="nofollow">http://localhost:5000/gvos/GvDevice/this_device</a> returns the result of GvDevice.this_device.</li><li>http://localhost5000<strong>/gvos/jams/command,&lt;jams module&gt;,&lt;method&gt; </strong>returns the result of executing the specified method in JAMS. For example, <a class="external-link" href="http://localhost:5000/gvos/jams/command,action,operator" rel="nofollow">http://localhost:5000/gvos/jams/command,action,operator</a> will return the result of calling &quot;action operator&quot; in JAMS.</li></ul><p>The GvWeb REST API is used by the React panel to load all of the model schemas and data, refresh the cache when it is stale, and execute remote methods in JAMS. If GvWeb is not running then the react panel will not work.</p><h2 id="DebuggingtheReactJSPanel-GvMQTT">GvMQTT</h2><p>The GvMQTT module handles subscribing to notifications for model updates and log messages. In order to enable GVOS to publish updates for a table or log you have to publish a message to one of the following topics using the MQTT protocol:</p><ul><li><p>gvos/&lt;DEVICE&gt;/logs/listen</p><ul><li><p>Post log subject(s) to enable gvos log subjects</p></li></ul></li><li><p>gvos/&lt;DEVICE&gt;/models/listen</p><ul><li><p>Post GvModel class names to enable notifications for database insert/update/delete operations</p></li></ul></li><li><p>gvos/&lt;DEVICE&gt;/sensors/listen</p><ul><li><p>Post GvSensorType name to enable output updates to any sensor</p></li></ul></li><li><p>gvos/&lt;DEVICE&gt;/signals/listen</p><ul><li><p>Post GvSymbol signal name to listen to any gv_signal()</p></li></ul></li></ul><p>Where &lt;DEVICE&gt; is the name of the device that gvos is running as and the body of the message is the name of the log/GvModel/GvSensorType/signal that you want GVOS to publish updates for. For example, to enable GVOS to publish updates for the JsTruck model on a device named T072 you would publish a message over mqtt to the topic 'gvos/T072/models/listen' and the message body would be 'JsTruck'. You can test this in the terminal using the mosquitto_pub tool as follows:</p><blockquote><p>mosquitto_pub -h localhost -p 1883 -t 'gvos/T072/models/listen' -m 'JsTruck'</p></blockquote><p>In order to avoid publishing data for topics that are no longer being listened to, GVOS will only publish updates for a topic for 60 seconds after it has received a listen request message for that topic. This means that you need to republish your listen request at least once every 60 seconds to ensure that GVOS continues to send updates for that topic.</p><p>In order to receive the updates that GVOS is publishing you will need to have your MQTT client subscribe to the appropriate topic:</p><ul><li><p>gvos/&lt;DEVICE&gt;/logs/&lt;NAME&gt;</p><ul><li><p>Subscribe to any enabled log subject</p></li></ul></li><li><p>gvos/&lt;DEVICE&gt;/models/&lt;NAME&gt;</p><ul><li><p>Subscribe to any GvModel subclass for database push notifications</p></li></ul></li><li><p>gvos/&lt;DEVICE&gt;/sensors/&lt;NAME&gt;</p><ul><li><p>Subscribe to any sensor by type name</p></li></ul></li><li><p>gvos/&lt;DEVICE&gt;/signals/&lt;NAME&gt;</p><ul><li><p>Subscribe to any signal by symbol name</p></li></ul></li></ul><p>Where &lt;NAME&gt; is the name of the log/GvMode/GvSensorType/signal that GVOS is publishing the message for. For example, if you've sent a listen request to GVOS  for the JsTruck model then GVOS will output notifications for inserts/deletes/updates to the 'gvos/T072/models/JsTruck' topic. You can test this in the terminal using the mosquitto_sub tool as follows:</p><blockquote><p>mosquitto_sub -h localhost -p 1883 -t 'gvos/T072/models/JsTruck'</p></blockquote><h2 id="DebuggingtheReactJSPanel-Replicas">Replicas</h2><p>GVOS and JAMS both use a database table named &quot;replicas&quot; to configure the tables that are uploaded and downloaded between the equipment and the server. However, when GVOS is running alongside JAMS, GVOS uses a table named &quot;replicas_oas&quot; instead. This means that the replica configurations for all equipment that use the GVOS replicator will be found in the replicas_oas table.</p><h2 id="DebuggingtheReactJSPanel-Configurations">Configurations</h2><p>The generic GVOS configurations are stored in JSON files in /opt/oas/configs. At startup GVOS loads all of the device groups for the equipment it is running as and then loads the relevant configurations for the groups from the JSON files. The configuration files are named for the device group that they represent so for example, the app-server.json file will have the configurations for the APP-SERVER device group. The JSON configurations are formatted as follows:</p><blockquote><p>{</p><p>  &quot;&lt;DEVICE GROUP&gt;&quot;: {</p><p>    &quot;apps&quot;: {</p><p>      &quot;&lt;component name 1&gt;&quot;: {</p><p>        &quot;&lt;property name 1&gt;&quot;:&quot;&lt;value&gt;&quot;,</p><p>        &quot;&lt;property name 2&gt;&quot;:&quot;&lt;value&gt;&quot;</p><p>      }</p><p>    },</p><p><span style="color: rgb(112,112,112);">    &quot;groups&quot;: </span><span style="color: rgb(112,112,112);">[&quot;&lt;CHILD DEVICE GROUP </span><span style="color: rgb(112,112,112);">1&quot;, &quot;CHILD DEVICE GROUP 2&quot;</span><span style="color: rgb(112,112,112);">]</span></p><p>  },</p><p>  &quot;&lt;DEVICE GROUP 2&gt;&quot;: { ... }</p><p>}</p></blockquote><p>Where &lt;DEVICE GROUP&gt; is the name of the device group that these configurations apply to, &lt;component name 1&gt; is the name of the component (module) that is being configured, &lt;property name 1&gt; and &lt;property name 2&gt; are the names of the component properties (attributes) that are being configured, &lt;value&gt; is the value(s) for the properties, and groups is the list of device group names that the device will also inherit by including the &lt;DEVICE GROUP&gt; in its group hierarchy. The configuration files will often include configurations for other related device groups so it is sometimes necessary to do a search in the configs directory to find the file(s) that your device group is configured in. Configurations can also be added in the configurations table, however this is usually not necessary as the generic GVOS configurations have everything you need to get a GVOS server and client running without having to add or change configurations in the database.</p><h3 id="DebuggingtheReactJSPanel-ConfiguringthedeviceforGVOS/JAMSintegration">Configuring the device for GVOS/JAMS integration</h3><p>In order to run the GVOS/JAMS clients together, the device must have the APP-JIGSAW group in it's group hierarchy (the groups field in the devices table). The APP-JIGSAW device contains the configurations for loading GvWeb, GvMQTT and GvProtoSql (the GVOS interface to JProtoSql). The react panel will not work unless the device has the APP-JIGSAW group.</p><h2 id="DebuggingtheReactJSPanel-LogFiles">Log Files</h2><p>The GVOS log files are stored in the /opt/oas/logs directory. When JAMS is running alongside GVOS, the JAMS logs are also stored in the /opt/oas/logs directory. Note that /opt/Jigsaw/Logs will still contain the messages log file.</p><h2 id="DebuggingtheReactJSPanel-RelevantGVOSLogs">Relevant GVOS Logs</h2><p>The following logs can be enabled in GVOS and can be useful for debugging issues with the panel:</p><p>mqtt</p><p>Shows when topics have been subscribed to and shows updates that have been published.</p><p>replicator</p><p>Shows information about which tables have been uploaded/downloaded.</p><p>jams</p><p>Shows the requests that are made to GVOS from JAMS.</p><p>web</p><p>Shows incoming http requests. </p><p>To enable these logs, connect to the core box of the equipment that you are debugging and start a telnet session on port 4640 to access the gvos shell (telnet localhost 4640). Once connected to the gvos shell enter &quot;listen &lt;logname&gt;&quot; to enable the log message. For example, to listen to the mqtt log enter &quot;listen mqtt&quot;.</p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-Mosquitto">Mosquitto</h1><p>The core box uses <a class="external-link" href="https://mosquitto.org/" rel="nofollow">mosquitto</a> as the MQTT broker. The mosquitto configuration file is located in /etc/mosquitto/mosquitto.conf and should already have the correct configuration out of the box. However, if you are experiences problems with receiving MQTT messages you should verify that mosquitto is running and is configured to listen on port 1883 and is also configured to start a web sockets listener on port 9001 (the web sockets listener is required for the react panel to communicate with the MQTT server). The default configuration for mosquitto is:</p><blockquote><p>user daemon<br/>port 1883<br/>listener 9001<br/>protocol websockets</p></blockquote></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-Nginx">Nginx</h1><p>The core box uses nginx to set up an HTTP server to serve the react panel page and assets. By default, nginx listens for requests on port 80 and serves files located in /www (which is where the react panel code and assets are located). nginx is configured to proxy all requests to the /gvos/ path to port 5000, which is the port that GvWeb is listening on. The default configuration for nginx is located at /etc/nginx/nginx.conf and additional configurations (such as the GvWeb proxy) are located in /etc/nginx/conf.d/.</p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-TimeSynchronization">Time Synchronization</h1><p>At the moment, the core/display9 setup uses a rather confusing system for time synchronization where the display9 uses the central server as the ntp source (which has to route through the core box to access the network) and the core box uses the display 9 as it's ntp source. It is important that the time on both devices remain in sync with the server as issues such as todos and messages being deleted have been reported as a result of the system time being off.</p><h2 id="DebuggingtheReactJSPanel-Chrony">Chrony</h2><p>The core box uses <a class="external-link" href="https://en.wikipedia.org/wiki/Chrony" rel="nofollow">Chrony</a> for managing ntp. The configuration for chrony can be found at /etc/chrony.conf. Chrony also comes with a tool called chronyc which can be used to check the status of the time synchronization and ntp servers, among other things.</p><h2 id="DebuggingtheReactJSPanel-Ntpd">Ntpd</h2><p>The display9 uses ntpd for managing ntp. The configuration for ntpd can be found at /etc/ntp.conf.</p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-Accessingthepanellog">Accessing the panel log</h1><p>The <a class="external-link" href="https://chromedevtools.github.io/devtools-protocol/" rel="nofollow">Chrome DevTools Protocol</a> provides us with a way to remotely access the developer console of the chromium instance running on the display 9. The developer console allows us to view the log messages and errors that are output by the panel, inspect network requests, perform memory profiling, and much more. To access the developer console you will need to tunnel to port 9222 of the display 9 using the following steps:</p><ol><li>Use ssh to create a tunnel from a port on your machine to a port on the client's server (in the example I forward my 9222 to the server's 9222 but you can change the ports if you need):<br/>ssh -L 9222:localhost:9222 client_server</li><li>On the client's server create a tunnel from the port you tunneled above to 9222 of the jigsaw core box:<br/>ssh -L 9222:localhost:9222 equipment_name</li><li>On the jigsaw core box create a tunnel from port 9222 to port 9222 on the display 9:<br/>ssh -L 9222:localhost:9222 master</li><li>On your machine, open a web browser and enter <a class="external-link" href="http://localhost:9222" rel="nofollow">http://localhost:9222</a> in the address bar (if you used a local port other than 9222 be sure to replace it in the url). Once it loads you will see the following: <br/><br/><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" src="attachments/228612840/228612829.png" data-image-src="attachments/228612840/228612829.png" data-unresolved-comment-count="0" data-linked-resource-id="228612829" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="chromium_debug_screen_1.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></li><li>Click on the section that says &quot;OpWeb Development&quot; to open the developer console. When the page loads it should look like the following image:<br/><br/><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" width="711" src="attachments/228612840/228612836.png" data-image-src="attachments/228612840/228612836.png" data-unresolved-comment-count="0" data-linked-resource-id="228612836" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="chromium_debug_console_2.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></li></ol><p>On the right side of the page is the developer console and on the left side is the current state of the page in the web browser (what the operator currently sees). The panel side functions similarly to VNC, so pressing any of the buttons will effect what the operator sees and will actually trigger the effect of the button on the operator's panel. On the top of the right side you'll see various tabs (&quot;Elements&quot;, &quot;Console&quot;, &quot;Sources&quot;, &quot;Network&quot;, etc). The console tab shows all of the log messages and errors that have been generated by the panel. You can save the entire log by clicking anywhere in the console tab and selecting &quot;Save as...&quot;. This will output all of the messages in the console to a text file that is saved in your local downloads folder.</p><p style="text-align: center;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" draggable="false" height="400" width="711" src="attachments/228612840/228612837.png" data-image-src="attachments/228612840/228612837.png" data-unresolved-comment-count="0" data-linked-resource-id="228612837" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="chromium_debug_console_3.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></p></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-RestartingtheReactpanel">Restarting the React panel</h1><p>There are a few different ways that the react panel can be restarted:</p><ul><li>From the remote developer console, press the refresh button at the top of the page (*not the refresh button for your browser*). This will simply refresh the web page forcing the react application to reload.</li><li>By pressing the 'Restart JsPanel' button in one of the equipment views in OPProManager. This will close out of the current instance of chromium and launch a new chromium instance.</li><li>By calling the chromium start up script with the restart argument on the display 9: /opt/etc/init.d/chromium restart. This will kill the current instance of chromium and launch a new chromium instance.</li><li>By executing the JSPanel script with the restart option from the core box: /opt/Jigsaw/Tools/JSPanel restart. This will kill the current instance of chromium and launch a new chromium instance.</li></ul></div>
</div>
</div>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="DebuggingtheReactJSPanel-Simulating">Simulating</h1><p>To simulate the panel you will need to have the GVOS, Jigsaw and react panel environments installed on your machine. If you can build GVOS and you do not need to run a Jigsaw server at the same time (for dispatch or other events) then you can build Jigsaw using the GVOS toolchain by adding the opguard=yes make option which builds only the files that are necessary to run a Jigsaw client (equipment) instance.</p><h2 id="DebuggingtheReactJSPanel-SimulatingGVOS">Simulating GVOS</h2><p>To simulate the panel you will first need to start a GVOS server and client for the equipment you are simulating. The gv_simulator script can be used to start the GVOS server and client as follows:</p><blockquote><p>/opt/oas/scripts/gv_simulator -d &lt;database name&gt; -U &lt;database user&gt; -p &lt;database password&gt; -fms &lt;Equipment name&gt;</p></blockquote><p>Note that the GVOS server starts GvWeb on port 5000 and the shell interface listens on port 4640 while the GVOS client starts GvWeb on port 5002 and the shell interface on port 4641. On the first run you will see the GVOS client restart once, this is normal and happens because GVOS needs to build the sqlite database for the equipment that you are simulating. You can find the sqlite database in the /tmp directory and it will be named &lt;Equipment name&gt;.db.</p><h2 id="DebuggingtheReactJSPanel-SimulatingJAMS">Simulating JAMS</h2><p>If your JAMS build was not built using the GVOS toolchain then be sure to make the necessary changes to your environment so that JAMS has access to the required libraries (usually need to change links for the /opt/local and /opt/GNUstep directories).</p><h3 id="DebuggingtheReactJSPanel-SimulatingaJAMSclient">Simulating a JAMS client</h3><p>To start a JAMS client you'll need to create a configuration file in /opt/Jigsaw/Services/&lt;equipment name&gt;.jams. Since gv_simulator opens the socket for the JProtoSQL interface on port 1301 you'll need to add some extra configurations to this file (unlike the config file found onboard the actual equipment which only contains the [host &lt;name&gt;] line). The configuration file should be set up as follows:</p><blockquote><p>[host &lt;Equipment Name&gt;]<br/>[port 1300]<br/>[jamssql host=localhost;<br/>              port=1301;<br/>              database=jmineops;<br/>              driver=jamssql;<br/>               is_local=true]</p></blockquote><p>This will ensure that the equipment is started with the JProtoSQL interface connected to port 1301 and the JAMS shell listening on port 1300. To start the JAMS client execute JAMSRun as follows:</p><blockquote><p>/opt/Jigsaw/Tools/JAMSRun -config /opt/Jigsaw/Services/&lt;equipment name&gt;/.jams -log JAMS,error,exception</p></blockquote><h3 id="DebuggingtheReactJSPanel-SimulatingaJAMSserver">Simulating a JAMS server</h3><p>To start a JAMS server you will need to create a configuration file in /opt/Jigsaw/Services/config.jams. The easiest way to do this is to copy /opt/Jigsaw/Services/config.jams.example to config.jams and then edit it. Your config.jams file should look like this:</p><blockquote><p>[host jamshost/24]<br/>[virtualDB]<br/>[replicator server=<a href="postgres://localhost/cmkc_test,user=developer,password=jigsaw" rel="nofollow">postgres://localhost/&lt;database name&gt;,user=developer,password=jigsaw</a>;<br/>                 broadcast=jamsbroadcast:1109;<br/>                 broadcastCount=8;<br/>                 broadcastSize=4000;<br/>                 liveProxyTimeout=0]<br/>[logger port=1110;enable=action,exception,optimizer,restriction]<br/>[JAMS domain=jamshost:1109]<br/>[mineOPS]<br/>[optimizer assign_by_idle=240;reassign_cost=240]<br/>[ruby]<br/>[proxyTCP]</p></blockquote><p>Once you have your configuration file created, you can start the JAMS server by executing the JAMSRouter script:</p><blockquote><p>/opt/Jigsaw/Services/JAMSRouter start</p></blockquote><p>Once the server is started you can use telnet to connected to the JAMS shell on port 1110.</p><h2 id="DebuggingtheReactJSPanel-SimulatingaReactpanel">Simulating a React panel</h2><h3 id="DebuggingtheReactJSPanel-Nginxconfiguration">Nginx configuration</h3><p>To simulate the react panel on your machine you will need to have nginx configured so that it can serve the sites.json file. To do this add the following configuration to your nginx.conf located in /etc/nginx/nginx.conf:</p><blockquote><p>server {<br/>    listen localhost:80;<br/>    server_name localhost;<br/>    root &lt;path to the web panel root directory&gt;;<br/>    location / {<br/>    }</p><p>}</p></blockquote><h3 id="DebuggingtheReactJSPanel-Mosquittoconfiguration">Mosquitto configuration</h3><p>You will need to ensure that your machine has a mosquitto that is built with web sockets support (at the time of this writing the version that comes with Ubuntu does not have web sockets enabled); you can find a mosquitto build with web socket support on neptune. Once you have the proper version of mosquitto installed, edit the configuration file at /etc/mosquitto/mosquitto.conf and add the following lines:</p><blockquote><p><span style="color: rgb(112,112,112);">port 1883</span><br/><span style="color: rgb(112,112,112);">listener 9001</span><br/><span style="color: rgb(112,112,112);">protocol websockets</span></p></blockquote><h3 id="DebuggingtheReactJSPanel-Panelconfiguration">Panel configuration</h3><p>We need to make a small change to one of the panel configuration files because gv_simulator starts GvWeb on port 5002 for the equipment. Open &lt;web panel root&gt;/src/setupProxy.js and change the line that contains '/gvos' so that the port is 5002 instead of 5000:</p><blockquote><p>const proxy = require('http-proxy-middleware');</p><p>module.exports = function (app) {<br/>  app.use('/sites.json', proxy({ target: '<a class="external-link" href="http://localhost:8002" rel="nofollow">http://localhost:80</a>', changeOrigin: true, toProxy: true }));<br/>  app.use('/gvos', proxy({ target: '<a class="external-link" href="http://localhost:5002" rel="nofollow">http://localhost:5002</a>', changeOrigin: true, toProxy: true }));<br/>};</p></blockquote><h3 id="DebuggingtheReactJSPanel-Startingthepanel">Starting the panel</h3><p>Before you start the panel for the first time make sure you run the following from inside the web panel root directory:</p><blockquote><p>npm install</p><p>npm install atomix-2.3.0.tgz</p></blockquote><p>Once all of the dependencies have been installed you can start the panel by running </p><blockquote><p>npm start</p></blockquote><p>This will launch a webpack development server on port 3000 and open a new tab in your browser that connects to <a class="external-link" href="http://localhost:3000" rel="nofollow">http://localhost:3000</a> (this is the address for the panel in development). Make sure that you are using a Chromium browser; if you aren't then download one.</p><h3 id="DebuggingtheReactJSPanel-ConfiguringDevTools">Configuring DevTools</h3><p>Once the page loads you can configure it to run at the same screen size as the display 9 by opening up the DevTools window and setting up a new device profile. To do this right click on the page and press &quot;inspect&quot; on the menu that pops up. This should open up the DevTools window.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" width="545" src="attachments/228612840/228613833.png" data-image-src="attachments/228612840/228613833.png" data-unresolved-comment-count="0" data-linked-resource-id="228613833" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="dev_tools_Window.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></p><p>Click on the cog icon at top right corner of the DevTools window to open up the settings menu. Next Click the &quot;Devices&quot; tab in the settings menu and then press the &quot;Add custom device...&quot; button.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" width="547" src="attachments/228612840/228613836.png" data-image-src="attachments/228612840/228613836.png" data-unresolved-comment-count="0" data-linked-resource-id="228613836" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="dev_tools_devices.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></p><p>Enter a device name and set the screen size to 1280 x 768 and the user agent type to &quot;Mobile&quot;. Save the configuration and then exit the settings menu.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" width="546" src="attachments/228612840/228613837.png" data-image-src="attachments/228612840/228613837.png" data-unresolved-comment-count="0" data-linked-resource-id="228613837" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="dev_tools_add_device.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></p><p>Next, at the top left corner of the DevTools window press the button that looks like a cellphone and a tablet (this is the &quot;Toggle device toolbar&quot; button). This will add a toolbar at the top of your web page that allows you to select the device type to emulate.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" width="547" src="attachments/228612840/228613834.png" data-image-src="attachments/228612840/228613834.png" data-unresolved-comment-count="0" data-linked-resource-id="228613834" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="dev_tools_toggle.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></p><p>Click on the device menu and select the device you just created from the drop down.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" draggable="false" height="400" src="attachments/228612840/228613835.png" data-image-src="attachments/228612840/228613835.png" data-unresolved-comment-count="0" data-linked-resource-id="228613835" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="dev_tools_device_toolbar.png" data-base-url="https://confluence.hexagonmining.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="228612840" data-linked-resource-container-version="17" alt=""></span></p><p><br/></p></div>
</div>
</div>
</div></p>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on dic 05, 2025 11:10</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
